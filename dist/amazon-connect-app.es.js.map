{"version":3,"file":"amazon-connect-app.es.js","sources":["../node_modules/@amazon-connect/core/lib-esm/provider/global-provider.js","../node_modules/@amazon-connect/core/lib-esm/error/connect-error.js","../node_modules/@amazon-connect/core/lib-esm/utility/deep-clone.js","../node_modules/@amazon-connect/core/lib-esm/utility/emitter/emitter-base.js","../node_modules/@amazon-connect/core/lib-esm/utility/emitter/async-event-emitter.js","../node_modules/@amazon-connect/core/lib-esm/utility/id-generator.js","../node_modules/@amazon-connect/core/lib-esm/proxy/module-proxy-factory.js","../node_modules/@amazon-connect/core/lib-esm/messaging/subscription/subscription-handler-id-map.js","../node_modules/@amazon-connect/core/lib-esm/messaging/subscription/subscription-map.js","../node_modules/@amazon-connect/core/lib-esm/messaging/subscription/subscription-manager.js","../node_modules/@amazon-connect/core/lib-esm/metric/duration-metric-recorder.js","../node_modules/@amazon-connect/core/lib-esm/metric/metric-helpers.js","../node_modules/@amazon-connect/core/lib-esm/metric/connect-metric-recorder.js","../node_modules/@amazon-connect/core/lib-esm/request/client-timeout-error.js","../node_modules/@amazon-connect/core/lib-esm/request/request-handler-factory.js","../node_modules/@amazon-connect/core/lib-esm/request/request-manager.js","../node_modules/@amazon-connect/core/lib-esm/request/request-message-factory.js","../node_modules/@amazon-connect/core/lib-esm/messaging/downstream-message-sanitizer.js","../node_modules/@amazon-connect/core/lib-esm/proxy/channel-manager.js","../node_modules/@amazon-connect/core/lib-esm/proxy/error/error-service.js","../node_modules/@amazon-connect/core/lib-esm/proxy/health-check/health-check-manager.js","../node_modules/@amazon-connect/core/lib-esm/proxy/proxy-connection/proxy-connection-status-manager.js","../node_modules/@amazon-connect/core/lib-esm/proxy/proxy.js","../node_modules/@amazon-connect/core/lib-esm/utility/timeout-tracker.js","../node_modules/@amazon-connect/core/lib-esm/logging/log-level.js","../node_modules/@amazon-connect/core/lib-esm/logging/log-data-console-writer.js","../node_modules/@amazon-connect/core/lib-esm/logging/log-data-transformer.js","../node_modules/@amazon-connect/core/lib-esm/logging/connect-logger.js","../node_modules/@amazon-connect/core/lib-esm/logging/sanitize-data.js","../node_modules/@amazon-connect/core/lib-esm/logging/log-message-factory.js","../node_modules/@amazon-connect/core/lib-esm/provider/provider-base.js","../node_modules/@amazon-connect/core/lib-esm/context/module-context.js","../node_modules/@amazon-connect/core/lib-esm/context/context.js","../node_modules/@amazon-connect/core/lib-esm/sdk-version.js","../node_modules/@amazon-connect/app/lib-esm/app-context.js","../node_modules/@amazon-connect/app/lib-esm/lifecycle/lifecycle-manager.js","../node_modules/@amazon-connect/app/lib-esm/lifecycle/app-lifecycle-manager.js","../node_modules/@amazon-connect/app/lib-esm/proxy/connection-timeout.js","../node_modules/@amazon-connect/app/lib-esm/proxy/app-proxy.js","../node_modules/@amazon-connect/app/lib-esm/amazon-connect-app.js","../node_modules/@amazon-connect/app/lib-esm/contact-scope.js","../node_modules/@amazon-connect/app/lib-esm/lifecycle/service-lifecycle-manager.js","../node_modules/@amazon-connect/app/lib-esm/service/amazon-connect-service.js","../node_modules/@amazon-connect/app/lib-esm/service/service-context.js"],"sourcesContent":["let _provider;\nexport function setGlobalProvider(provider) {\n    if (_provider)\n        throw new Error(\"Global Provider is already set\");\n    _provider = provider;\n}\nexport function resetGlobalProvider(provider) {\n    _provider = provider;\n}\nexport function getGlobalProvider(notSetMessage) {\n    if (!_provider) {\n        throw new Error(notSetMessage !== null && notSetMessage !== void 0 ? notSetMessage : \"Attempted to get Global AmazonConnectProvider that has not been set.\");\n    }\n    return _provider;\n}\n//# sourceMappingURL=global-provider.js.map","export class ConnectError extends Error {\n    constructor({ reason, namespace, errorKey, details, }) {\n        super(`ConnectError with error key \"${errorKey}\"`);\n        this.errorType = ConnectError.ErrorType;\n        this.namespace = namespace;\n        this.errorKey = errorKey;\n        this.reason = reason;\n        this.details = details !== null && details !== void 0 ? details : {};\n    }\n}\nConnectError.ErrorType = \"ConnectError\";\nexport function isConnectError(error) {\n    return Boolean(error instanceof ConnectError ||\n        (error &&\n            typeof error === \"object\" &&\n            \"errorType\" in error &&\n            error.errorType === ConnectError.ErrorType));\n}\n//# sourceMappingURL=connect-error.js.map","import { ConnectError } from \"../error\";\nexport function deepClone(object) {\n    try {\n        return structuredClone(object);\n    }\n    catch (_a) {\n        try {\n            // Falls back to JSON parse/stringify if structureClone does not exist\n            return JSON.parse(JSON.stringify(object));\n        }\n        catch (cloneError) {\n            throw new ConnectError({\n                errorKey: \"deepCloneFailed\",\n                details: {\n                    actualError: cloneError,\n                },\n            });\n        }\n    }\n}\n//# sourceMappingURL=deep-clone.js.map","import { ConnectLogger } from \"../../logging\";\nexport class EmitterBase {\n    constructor({ provider, loggerKey }) {\n        this.events = new Map();\n        this.logger = new ConnectLogger({\n            provider,\n            source: \"emitter\",\n            mixin: () => ({\n                emitterLoggerKey: loggerKey,\n            }),\n        });\n    }\n    on(parameter, handler) {\n        const set = this.events.get(parameter);\n        if (set)\n            set.add(handler);\n        else\n            this.events.set(parameter, new Set([handler]));\n    }\n    off(parameter, handler) {\n        const set = this.events.get(parameter);\n        if (set) {\n            set.delete(handler);\n            if (set.size < 1)\n                this.events.delete(parameter);\n        }\n    }\n    getHandlers(parameter) {\n        var _a;\n        return Array.from((_a = this.events.get(parameter)) !== null && _a !== void 0 ? _a : []);\n    }\n}\n//# sourceMappingURL=emitter-base.js.map","var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nimport { EmitterBase } from \"./emitter-base\";\nexport class AsyncEventEmitter extends EmitterBase {\n    emit(parameter, event) {\n        return __awaiter(this, void 0, void 0, function* () {\n            const handlers = this.getHandlers(parameter);\n            yield Promise.allSettled(handlers.map((handler) => __awaiter(this, void 0, void 0, function* () {\n                try {\n                    yield handler(event);\n                }\n                catch (error) {\n                    this.logger.error(\"An error occurred when invoking event handler\", {\n                        error,\n                        parameter,\n                    });\n                }\n            })));\n        });\n    }\n}\n//# sourceMappingURL=async-event-emitter.js.map","export function generateStringId(length) {\n    const a = new Uint8Array(Math.ceil(length / 2));\n    crypto.getRandomValues(a);\n    return Array.from(a, (d) => d.toString(16).padStart(2, \"0\"))\n        .join(\"\")\n        .substring(0, length);\n}\nexport function generateUUID() {\n    if (\"randomUUID\" in crypto) {\n        return crypto.randomUUID();\n    }\n    else {\n        return \"10000000-1000-4000-8000-100000000000\".replace(/[018]/g, (c) => {\n            const d = parseInt(c);\n            return (d ^\n                (crypto.getRandomValues(new Uint8Array(1))[0] & (15 >> (d / 4)))).toString(16);\n        });\n    }\n}\n//# sourceMappingURL=id-generator.js.map","export function createModuleProxy(proxy, namespace) {\n    return {\n        request: (command, data) => proxy.request(namespace, command, data),\n        subscribe: (topic, handler) => proxy.subscribe(Object.assign(Object.assign({}, topic), { namespace }), handler),\n        unsubscribe: (topic, handler) => proxy.unsubscribe(Object.assign(Object.assign({}, topic), { namespace }), handler),\n        getProxyInfo: () => ({\n            connectionStatus: proxy.connectionStatus,\n            proxyType: proxy.proxyType,\n        }),\n        onConnectionStatusChange: (h) => proxy.onConnectionStatusChange(h),\n        offConnectionStatusChange: (h) => proxy.offConnectionStatusChange(h),\n    };\n}\n//# sourceMappingURL=module-proxy-factory.js.map","import { generateUUID } from \"../../utility\";\nexport class SubscriptionHandlerIdMap {\n    constructor() {\n        this.idsByHandler = new Map();\n        this.handlersById = new Map();\n    }\n    add(handler) {\n        const existingId = this.idsByHandler.get(handler);\n        if (existingId) {\n            return { handlerId: existingId };\n        }\n        const handlerId = generateUUID();\n        this.idsByHandler.set(handler, handlerId);\n        this.handlersById.set(handlerId, handler);\n        return { handlerId };\n    }\n    getIdByHandler(handler) {\n        var _a;\n        return (_a = this.idsByHandler.get(handler)) !== null && _a !== void 0 ? _a : null;\n    }\n    getHandlerById(id) {\n        var _a;\n        return (_a = this.handlersById.get(id)) !== null && _a !== void 0 ? _a : null;\n    }\n    get() {\n        return [...this.idsByHandler.entries()].map(([handler, handlerId]) => ({\n            handler,\n            handlerId,\n        }));\n    }\n    delete(handler) {\n        const handlerId = this.idsByHandler.get(handler);\n        if (handlerId)\n            this.handlersById.delete(handlerId);\n        this.idsByHandler.delete(handler);\n        return { isEmpty: this.idsByHandler.size < 1 };\n    }\n    size() {\n        return this.idsByHandler.size;\n    }\n}\n//# sourceMappingURL=subscription-handler-id-map.js.map","export class SubscriptionMap {\n    constructor() {\n        this.simpleSubscriptions = new Map();\n        this.paramSubscriptions = new Map();\n    }\n    add({ namespace, key, parameter: param }, value) {\n        var _a, _b, _c, _d, _e;\n        if (param) {\n            if (!this.paramSubscriptions.has(namespace)) {\n                this.paramSubscriptions.set(namespace, new Map([[key, new Map([[param, value]])]]));\n                return;\n            }\n            if (!((_a = this.paramSubscriptions.get(namespace)) === null || _a === void 0 ? void 0 : _a.has(key))) {\n                (_b = this.paramSubscriptions\n                    .get(namespace)) === null || _b === void 0 ? void 0 : _b.set(key, new Map([[param, value]]));\n                return;\n            }\n            (_d = (_c = this.paramSubscriptions.get(namespace)) === null || _c === void 0 ? void 0 : _c.get(key)) === null || _d === void 0 ? void 0 : _d.set(param, value);\n        }\n        else {\n            if (!this.simpleSubscriptions.has(namespace)) {\n                this.simpleSubscriptions.set(namespace, new Map([[key, value]]));\n                return;\n            }\n            else\n                (_e = this.simpleSubscriptions.get(namespace)) === null || _e === void 0 ? void 0 : _e.set(key, value);\n        }\n    }\n    delete({ namespace, key, parameter: param }) {\n        var _a, _b, _c, _d;\n        if (param) {\n            if ((_b = (_a = this.paramSubscriptions.get(namespace)) === null || _a === void 0 ? void 0 : _a.get(key)) === null || _b === void 0 ? void 0 : _b.delete(param)) {\n                if (this.paramSubscriptions.get(namespace).get(key).size < 1) {\n                    (_c = this.paramSubscriptions.get(namespace)) === null || _c === void 0 ? void 0 : _c.delete(key);\n                    if (this.paramSubscriptions.get(namespace).size < 1) {\n                        this.paramSubscriptions.delete(namespace);\n                    }\n                }\n            }\n        }\n        else {\n            if ((_d = this.simpleSubscriptions.get(namespace)) === null || _d === void 0 ? void 0 : _d.delete(key)) {\n                if (this.simpleSubscriptions.get(namespace).size < 1) {\n                    this.simpleSubscriptions.delete(namespace);\n                }\n            }\n        }\n    }\n    get({ namespace, key, parameter: param }) {\n        var _a, _b, _c;\n        if (!param) {\n            return (_a = this.simpleSubscriptions.get(namespace)) === null || _a === void 0 ? void 0 : _a.get(key);\n        }\n        else {\n            return (_c = (_b = this.paramSubscriptions.get(namespace)) === null || _b === void 0 ? void 0 : _b.get(key)) === null || _c === void 0 ? void 0 : _c.get(param);\n        }\n    }\n    getOrAdd(topic, addFactory) {\n        let value = this.get(topic);\n        if (!value) {\n            value = addFactory();\n            this.add(topic, value);\n        }\n        return value;\n    }\n    addOrUpdate(topic, addFactory, updateAction) {\n        let value = this.get(topic);\n        if (value) {\n            value = updateAction(value);\n        }\n        else {\n            value = addFactory();\n        }\n        this.add(topic, value);\n        return value;\n    }\n    getAllSubscriptions() {\n        const noParam = Array.from(this.simpleSubscriptions.keys()).flatMap((namespace) => Array.from(this.simpleSubscriptions.get(namespace).keys()).flatMap((key) => ({\n            namespace,\n            key,\n        })));\n        const withParam = Array.from(this.paramSubscriptions.keys()).flatMap((namespace) => Array.from(this.paramSubscriptions.get(namespace).keys()).flatMap((key) => Array.from(this.paramSubscriptions.get(namespace).get(key).keys()).flatMap((parameter) => ({\n            namespace,\n            key,\n            parameter,\n        }))));\n        return [...noParam, ...withParam];\n    }\n}\n//# sourceMappingURL=subscription-map.js.map","import { SubscriptionHandlerIdMap } from \"./subscription-handler-id-map\";\nimport { SubscriptionMap } from \"./subscription-map\";\nexport class SubscriptionManager {\n    constructor() {\n        this.subscriptions = new SubscriptionMap();\n    }\n    add(topic, handler) {\n        return this.subscriptions\n            .getOrAdd(topic, () => new SubscriptionHandlerIdMap())\n            .add(handler);\n    }\n    get(topic) {\n        var _a, _b;\n        return (_b = (_a = this.subscriptions.get(topic)) === null || _a === void 0 ? void 0 : _a.get()) !== null && _b !== void 0 ? _b : [];\n    }\n    getById(topic, handlerId) {\n        var _a, _b;\n        return (_b = (_a = this.subscriptions.get(topic)) === null || _a === void 0 ? void 0 : _a.getHandlerById(handlerId)) !== null && _b !== void 0 ? _b : null;\n    }\n    delete(topic, handler) {\n        var _a, _b;\n        if ((_b = (_a = this.subscriptions.get(topic)) === null || _a === void 0 ? void 0 : _a.delete(handler).isEmpty) !== null && _b !== void 0 ? _b : false) {\n            this.subscriptions.delete(topic);\n        }\n    }\n    size(topic) {\n        var _a, _b;\n        return (_b = (_a = this.subscriptions.get(topic)) === null || _a === void 0 ? void 0 : _a.size()) !== null && _b !== void 0 ? _b : 0;\n    }\n    isEmpty(topic) {\n        return this.size(topic) === 0;\n    }\n    getAllSubscriptions() {\n        return this.subscriptions.getAllSubscriptions();\n    }\n    getAllSubscriptionHandlerIds() {\n        return this.subscriptions\n            .getAllSubscriptions()\n            .reduce((acc, topic) => acc.concat(this.get(topic).map(({ handlerId }) => ({\n            topic,\n            handlerId,\n        }))), []);\n    }\n}\n//# sourceMappingURL=subscription-manager.js.map","/**\n * @classdesc DurationMetricRecorder class provides APIs to emit duration metrics based on users' need\n */\nexport class DurationMetricRecorder {\n    /**\n     * Constructor for DurationMetricRecorder\n     * @param {(metric: MetricData) => void} sendMetric- The method that sends metric\n     * @param {string} metricName - The name of the duration metric\n     * @param {Record<string, string>} dimensions - The dimensions of the duration metric with keys and values (optional)\n     * @param {Record<string, string>} optionalDimensions - The optional dimensions of the duration metric with keys and values (optional)\n     */\n    constructor({ sendMetric, metricName, metricOptions, }) {\n        this.unit = \"Milliseconds\";\n        this.sendMetric = sendMetric;\n        this.startTime = performance.now();\n        this.metricName = metricName;\n        this.dimensions = (metricOptions === null || metricOptions === void 0 ? void 0 : metricOptions.dimensions) ? metricOptions.dimensions : {};\n        this.optionalDimensions = (metricOptions === null || metricOptions === void 0 ? void 0 : metricOptions.optionalDimensions)\n            ? metricOptions.optionalDimensions\n            : {};\n    }\n    /**\n     * Stop recording of the duration metric and emit it\n     * @returns {durationCount: number} - The duration being recorded\n     */\n    stopDurationCounter() {\n        const durationResult = Math.round(performance.now() - this.startTime);\n        this.sendMetric({\n            metricName: this.metricName,\n            unit: this.unit,\n            value: durationResult,\n            dimensions: this.dimensions,\n            optionalDimensions: this.optionalDimensions,\n        });\n        return { duration: durationResult };\n    }\n}\n//# sourceMappingURL=duration-metric-recorder.js.map","export const MAX_METRIC_DIMENSIONS = 30;\n/**\n * Check if the the sum of the length of dimensions and optional dimentions is exceeding maximum dimension length acceptable by back-end\n * @param {Record<string, string>} dimensions - The dimensions of the duration metric with keys and values\n * @param {Record<string, string>} optionalDimensions -The optional dimensions of the duration metric with keys and values\n */\nexport function checkDimensionLength(dimensions, optionalDimensions) {\n    if (Object.keys(dimensions).length +\n        Object.keys(optionalDimensions !== null && optionalDimensions !== void 0 ? optionalDimensions : {}).length >\n        MAX_METRIC_DIMENSIONS) {\n        throw new Error(\"Cannot add more than 30 dimensions to a metric\");\n    }\n}\n/**\n * Transform the metric message into the format acceptable by back-end\n * @param {MetricData} metricData - The metric data\n * @param {string} timestamp - The timestamp of the metric\n * @param {string} namespace - The namespace of the metric\n * @param {UpstreamMessageOrigin} messageOrigin - The origin of the metric message\n * @return {MetricMessage} - Return a MetricMessage object\n */\nexport function createMetricMessage({ metricData, time, namespace }, messageOrigin) {\n    var _a, _b;\n    return {\n        type: \"metric\",\n        namespace: namespace,\n        metricName: metricData.metricName,\n        unit: metricData.unit,\n        value: metricData.value,\n        time: time,\n        dimensions: (_a = metricData.dimensions) !== null && _a !== void 0 ? _a : {},\n        optionalDimensions: (_b = metricData.optionalDimensions) !== null && _b !== void 0 ? _b : {},\n        messageOrigin,\n    };\n}\n//# sourceMappingURL=metric-helpers.js.map","import { getGlobalProvider } from \"../provider\";\nimport { DurationMetricRecorder } from \"./duration-metric-recorder\";\nimport { checkDimensionLength } from \"./metric-helpers\";\n/**\n * @classdesc ConnectMetricRecorder class provides APIs to emit metrics based on users' need\n */\nexport class ConnectMetricRecorder {\n    /**\n     * Constructor for ConnectMetricRecorder\n     * @param {ConnectRecorderMetricParams} params - The namespace and provider(optional)\n     */\n    constructor(params) {\n        this._proxy = null;\n        this.namespace = params.namespace;\n        if (params.provider && typeof params.provider === \"function\")\n            this.providerFactory = params.provider;\n        else\n            this.provider = params.provider;\n    }\n    /**\n     * Emit a metric that counts success\n     * @param {string} metricName - The name of the metric\n     * @param {Record<string, string>} dimensions - The dimensions of a metric with keys and values (optional)\n     * @param {Record<string, string>} optionalDimensions - The optional dimensions of a metric with keys and values (optional)\n     */\n    recordSuccess(metricName, metricOptions) {\n        var _a;\n        const processedDimensions = Object.assign({}, ((_a = metricOptions === null || metricOptions === void 0 ? void 0 : metricOptions.dimensions) !== null && _a !== void 0 ? _a : {}));\n        const processedMetricOptions = Object.assign(Object.assign({}, metricOptions), { dimensions: processedDimensions });\n        this.recordCount(metricName, 0, processedMetricOptions);\n    }\n    /**\n     * Emit a metric that counts error. Add default dimension { name: \"Metric\", value: \"Error\" } to the metric if not added\n     * @param {string} metricName - The name of the metric\n     * @param {Record<string, string>} dimensions - The dimensions of a metric with keys and values (optional)\n     * @param {Record<string, string>} optionalDimensions - The optional dimensions of a metric with keys and values (optional)\n     */\n    recordError(metricName, metricOptions) {\n        var _a;\n        const processedDimensions = Object.assign({}, ((_a = metricOptions === null || metricOptions === void 0 ? void 0 : metricOptions.dimensions) !== null && _a !== void 0 ? _a : {}));\n        const processedMetricOptions = Object.assign(Object.assign({}, metricOptions), { dimensions: processedDimensions });\n        this.recordCount(metricName, 1, processedMetricOptions);\n    }\n    /**\n     * Emit a counting metric\n     * @param {string} metricName - The name of the metric\n     * @param {number} count - The count of the metric\n     * @param {Record<string, string>} dimensions - The dimensions of a metric with keys and values (optional)\n     * @param {Record<string, string>} optionalDimensions - The optional dimensions of a metric with keys and values (optional)\n     */\n    recordCount(metricName, count, metricOptions) {\n        this.sendMetric({\n            metricName,\n            unit: \"Count\",\n            value: count,\n            dimensions: metricOptions === null || metricOptions === void 0 ? void 0 : metricOptions.dimensions,\n            optionalDimensions: metricOptions === null || metricOptions === void 0 ? void 0 : metricOptions.optionalDimensions,\n        });\n    }\n    /**\n     * Start a duration metric\n     * @param {string} metricName - The name of the metric\n     * @param {Record<string, string>} dimensions - The dimensions of a metric with keys and values (optional)\n     * @param {Record<string, string>} optionalDimensions - The optional dimensions of a metric with keys and values (optional)\n     * @returns {DurationMetricRecorder} - The DurationMetricRecorder object being created\n     */\n    startDurationCounter(metricName, metricOptions) {\n        return new DurationMetricRecorder({\n            sendMetric: this.sendMetric.bind(this),\n            metricName,\n            metricOptions,\n        });\n    }\n    /**\n     * Emit metric\n     * @param {string} metricName - The name of the metric\n     * @param {unit} unit - The unit of the metric\n     * @param {number} value - The value of the metric\n     * @param {Record<string, string>} dimensions - The dimensions of a metric with keys and values (optional)\n     * @param {Record<string, string>} optionalDimensions - The optional dimensions of a metric with keys and values (optional)\n     */\n    sendMetric({ metricName, unit, value, dimensions, optionalDimensions, }) {\n        if (dimensions) {\n            checkDimensionLength(dimensions, optionalDimensions);\n        }\n        const metricData = {\n            metricName,\n            unit,\n            value,\n            dimensions,\n            optionalDimensions,\n        };\n        const time = new Date();\n        this.getProxy().sendMetric({\n            metricData,\n            time,\n            namespace: this.namespace,\n        });\n    }\n    /**\n     * Get the provider of the ConnectMetricRecorder instance\n     */\n    getProvider() {\n        if (!this.provider) {\n            this.provider = this.providerFactory\n                ? this.providerFactory()\n                : getGlobalProvider();\n        }\n        return this.provider;\n    }\n    /**\n     * Get the proxy of the ConnectMetricRecorder instance\n     */\n    getProxy() {\n        if (!this._proxy) {\n            this._proxy = this.getProvider().getProxy();\n        }\n        return this._proxy;\n    }\n}\n//# sourceMappingURL=connect-metric-recorder.js.map","export const clientTimeoutResponseErrorKey = \"clientTimeout\";\nexport function formatClientTimeoutError(request, timeoutMs) {\n    const { namespace, command, data: requestData } = request;\n    return {\n        namespace,\n        reason: \"Client Timeout\",\n        details: {\n            command,\n            requestData,\n            timeoutMs,\n        },\n        errorKey: clientTimeoutResponseErrorKey,\n    };\n}\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nexport function isClientTimeoutResponseError(err) {\n    return (\n    // eslint-disable-next-line @typescript-eslint/no-unsafe-member-access\n    typeof err === \"object\" && err.errorKey === clientTimeoutResponseErrorKey);\n}\n//# sourceMappingURL=client-timeout-error.js.map","import { ConnectError } from \"../error\";\nimport { formatClientTimeoutError } from \"./client-timeout-error\";\nconst DEFAULT_TIMEOUT_MS = 30 * 1000;\nexport function createRequestHandler(request, onStart, onTimeout, timeoutMs) {\n    const adjustedTimeoutMs = Math.max(1, timeoutMs !== null && timeoutMs !== void 0 ? timeoutMs : DEFAULT_TIMEOUT_MS);\n    return new Promise((resolve, reject) => {\n        let isTimedOut = false;\n        const timeout = setTimeout(() => {\n            onTimeout({ timeoutMs: adjustedTimeoutMs, request });\n            // eslint-disable-next-line @typescript-eslint/prefer-promise-reject-errors\n            reject(formatClientTimeoutError(request, adjustedTimeoutMs));\n            isTimedOut = true;\n        }, adjustedTimeoutMs);\n        const handler = (msg) => {\n            clearTimeout(timeout);\n            if (!isTimedOut) {\n                if (msg.isError) {\n                    reject(new ConnectError(msg));\n                }\n                else {\n                    resolve(msg.data);\n                }\n            }\n        };\n        onStart(handler);\n    });\n}\n//# sourceMappingURL=request-handler-factory.js.map","import { ConnectLogger } from \"../logging\";\nimport { createRequestHandler, } from \"./request-handler-factory\";\nexport class RequestManager {\n    constructor(provider) {\n        this.requestMap = new Map();\n        this.logger = new ConnectLogger({\n            provider,\n            source: \"core.requestManager\",\n        });\n    }\n    processRequest(request) {\n        const { requestId } = request;\n        return createRequestHandler(request, (handler) => this.requestMap.set(requestId, handler), ({ request, timeoutMs }) => this.handleTimeout(request, timeoutMs));\n    }\n    processResponse(response) {\n        const { requestId } = response;\n        const handler = this.requestMap.get(requestId);\n        if (!handler) {\n            // The proxy is implemented such that this should never happen\n            this.logger.error(\"Returned a response message with no handler\", {\n                message: response,\n            });\n            return;\n        }\n        handler(response);\n        this.requestMap.delete(requestId);\n    }\n    handleTimeout(request, timeoutMs) {\n        const { requestId, namespace, command } = request;\n        this.requestMap.delete(requestId);\n        this.logger.error(\"Client request timeout\", {\n            requestId,\n            namespace,\n            command,\n            timeoutMs,\n        });\n    }\n}\n//# sourceMappingURL=request-manager.js.map","import { generateUUID } from \"../utility\";\nexport function createRequestMessage(namespace, command, data, messageOrigin) {\n    const requestId = generateUUID();\n    return {\n        type: \"request\",\n        namespace,\n        command,\n        requestId,\n        data,\n        messageOrigin,\n    };\n}\n//# sourceMappingURL=request-message-factory.js.map","var __rest = (this && this.__rest) || function (s, e) {\n    var t = {};\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\n        t[p] = s[p];\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\n                t[p[i]] = s[p[i]];\n        }\n    return t;\n};\nexport function sanitizeDownstreamMessage(message) {\n    try {\n        switch (message.type) {\n            case \"acknowledge\":\n            case \"error\":\n            case \"childConnectionClose\":\n                return message;\n            case \"childDownstreamMessage\":\n                return Object.assign(Object.assign({}, message), { message: sanitizeDownstreamMessage(message.message) });\n            case \"publish\": {\n                const { data } = message, other = __rest(message, [\"data\"]);\n                return Object.assign({}, other);\n            }\n            case \"response\": {\n                if (message.isError)\n                    return Object.assign(Object.assign({}, message), { details: { command: message.details.command } });\n                else {\n                    const { data } = message, other = __rest(message, [\"data\"]);\n                    return Object.assign({}, other);\n                }\n            }\n            default:\n                return message;\n        }\n    }\n    catch (error) {\n        return {\n            messageDetails: \"error when sanitizing downstream message\",\n            message,\n            error,\n        };\n    }\n}\n//# sourceMappingURL=downstream-message-sanitizer.js.map","import { ConnectLogger } from \"../logging\";\nimport { sanitizeDownstreamMessage, } from \"../messaging\";\n/**\n * Manages communication channels between the proxy and child entities.\n *\n * The ChannelManager supports two types of communication channels:\n * 1. Iframe channels - Use browser MessagePort API for communication across different execution contexts\n * 2. Component channels - Use direct function calls when both entities exist in the same execution context\n *\n * Key responsibilities:\n * - Adding and removing child channels\n * - Routing downstream messages from proxy to child entities\n * - Relaying upstream messages from child entities back to the proxy\n * - Managing MessagePort lifecycle (opening, closing, cleanup)\n * - Validating provider IDs to ensure secure message routing\n *\n * @example Iframe Channel\n * ```typescript\n * const { port1, port2 } = new MessageChannel();\n * channelManager.addChannel({\n *   connectionId: \"child-uuid\",\n *   providerId: \"provider-uuid\",\n *   type: \"iframe\",\n *   port: port1\n * });\n * // port2 gets transferred to child entity\n * ```\n *\n * @example Component Channel\n * ```typescript\n * channelManager.addChannel({\n *   connectionId: \"child-uuid\",\n *   providerId: \"provider-uuid\",\n *   type: \"component\",\n *   sendDownstreamMessage: (msg) => childEntity.receive(msg),\n *   setUpstreamMessageHandler: (handler) => childEntity.onUpstream = handler\n * });\n * ```\n */\nexport class ChannelManager {\n    constructor(provider, relayChildUpstreamMessage) {\n        this.provider = provider;\n        this.relayChildUpstreamMessage = relayChildUpstreamMessage;\n        this.channels = new Map();\n        this.logger = new ConnectLogger({\n            provider,\n            source: \"childConnectionManager\",\n        });\n    }\n    /**\n     * Adds a new communication channel for a child entity.\n     *\n     * Supports both iframe and component channel types. For iframe channels,\n     * sets up message event listeners and starts the port. For component channels,\n     * configures the upstream message handler. Both types send a \"childConnectionReady\"\n     * message upstream to notify the proxy that the channel is established.\n     *\n     * @param params - Channel configuration parameters\n     * @param params.connectionId - UUID identifier for this channel connection\n     * @param params.providerId - UUID of the provider that owns this channel\n     * @param params.type - Channel type: \"iframe\" or \"component\"\n     *\n     * @example Iframe Channel\n     * ```typescript\n     * const { port1, port2 } = new MessageChannel();\n     * channelManager.addChannel({\n     *   connectionId: \"550e8400-e29b-41d4-a716-446655440000\",\n     *   providerId: \"6ba7b810-9dad-11d1-80b4-00c04fd430c8\",\n     *   type: \"iframe\",\n     *   port: port1\n     * });\n     * ```\n     *\n     * @example Component Channel\n     * ```typescript\n     * channelManager.addChannel({\n     *   connectionId: \"550e8400-e29b-41d4-a716-446655440001\",\n     *   providerId: \"6ba7b810-9dad-11d1-80b4-00c04fd430c8\",\n     *   type: \"component\",\n     *   sendDownstreamMessage: (msg) => childEntity.receive(msg),\n     *   setUpstreamMessageHandler: (handler) => childEntity.onUpstream = handler\n     * });\n     * ```\n     */\n    addChannel(params) {\n        const { connectionId } = params;\n        if (this.channels.has(connectionId)) {\n            this.logger.error(\"Attempted to add child connection that already exists. No action\", {\n                connectionId,\n            });\n            return;\n        }\n        if (params.type === \"iframe\") {\n            this.setupIframe(params);\n        }\n        else {\n            this.setupComponent(params);\n        }\n        this.logger.debug(\"Child channel added\", {\n            connectionId,\n            type: params.type,\n        });\n    }\n    /**\n     * Updates an existing MessagePort channel with a new MessagePort.\n     *\n     * This method is only applicable to MessagePort channels. Direct channels cannot\n     * be updated and will result in an error. The old MessagePort is properly cleaned up\n     * (event listeners removed, port closed) before the new port is configured.\n     *\n     * @param params - Update parameters\n     * @param params.connectionId - UUID identifier for the channel to update\n     * @param params.port - New MessagePort instance to replace the existing one\n     * @param params.providerId - UUID of the provider that owns this channel\n     *\n     * @throws Logs error if connectionId doesn't exist or channel is Direct type\n     *\n     * @example\n     * ```typescript\n     * const { port1, port2 } = new MessageChannel();\n     * channelManager.updateChannelPort({\n     *   connectionId: \"550e8400-e29b-41d4-a716-446655440000\",\n     *   port: port1,\n     *   providerId: \"6ba7b810-9dad-11d1-80b4-00c04fd430c8\"\n     * });\n     * ```\n     */\n    updateChannelPort(params) {\n        const { connectionId } = params;\n        const existingChannel = this.channels.get(connectionId);\n        if (!existingChannel) {\n            this.logger.error(\"Attempted to update child connection that does not exist No action\", {\n                connectionId,\n            });\n            return;\n        }\n        if (existingChannel.type === \"component\") {\n            this.logger.error(\"Attempted to update a component channel connection as MessagePort. This is not supported.\", {\n                connectionId,\n            });\n            return;\n        }\n        const originalChannel = existingChannel;\n        originalChannel.port.onmessage = null;\n        originalChannel.port.close();\n        const setupParams = Object.assign(Object.assign({}, params), { type: \"iframe\" });\n        this.setupIframe(setupParams);\n        this.logger.info(\"Updated child port\", { connectionId });\n    }\n    setupIframe(params) {\n        const { connectionId, port, providerId } = params;\n        const handler = this.createMessageHandler(connectionId, providerId);\n        port.addEventListener(\"message\", handler);\n        port.start();\n        this.channels.set(connectionId, {\n            type: \"iframe\",\n            port,\n            handler,\n            providerId,\n        });\n        this.relayChildUpstreamMessage({\n            type: \"childUpstream\",\n            connectionId,\n            sourceProviderId: providerId,\n            parentProviderId: this.provider.id,\n            message: {\n                type: \"childConnectionReady\",\n            },\n        });\n    }\n    setupComponent(params) {\n        const { connectionId, providerId, sendDownstreamMessage, setUpstreamMessageHandler, } = params;\n        const upstreamHandler = (message) => {\n            this.relayChildUpstreamMessage({\n                type: \"childUpstream\",\n                sourceProviderId: providerId,\n                parentProviderId: this.provider.id,\n                connectionId,\n                message,\n            });\n        };\n        setUpstreamMessageHandler(upstreamHandler);\n        this.channels.set(connectionId, {\n            type: \"component\",\n            providerId,\n            sendDownstreamMessage,\n            setUpstreamMessageHandler,\n        });\n        this.relayChildUpstreamMessage({\n            type: \"childUpstream\",\n            connectionId,\n            sourceProviderId: providerId,\n            parentProviderId: this.provider.id,\n            message: {\n                type: \"childConnectionReady\",\n            },\n        });\n    }\n    /**\n     * Routes a downstream message from the proxy to the appropriate child channel.\n     *\n     * Validates that the target channel exists and that the provider ID matches\n     * (for security). For MessagePort channels, uses postMessage(). For Direct\n     * channels, calls the sendDownstreamMessage function.\n     *\n     * @param params - Downstream message parameters\n     * @param params.connectionId - UUID of the target channel\n     * @param params.message - The message to send to the child entity\n     * @param params.targetProviderId - Expected provider ID for validation\n     *\n     * @example\n     * ```typescript\n     * channelManager.handleDownstreamMessage({\n     *   connectionId: \"550e8400-e29b-41d4-a716-446655440000\",\n     *   message: { type: \"request\", data: \"some data\" },\n     *   targetProviderId: \"6ba7b810-9dad-11d1-80b4-00c04fd430c8\"\n     * });\n     * ```\n     */\n    handleDownstreamMessage({ connectionId, message, targetProviderId, }) {\n        const channelData = this.channels.get(connectionId);\n        if (!channelData) {\n            this.logger.warn(\"Attempted to route downstream message to child channel that does not exist\", { connectionId, message: sanitizeDownstreamMessage(message) });\n            return;\n        }\n        const { providerId } = channelData;\n        // Older versions of the SDK do not provide a provider id. This\n        // check is ignored for versions without a providerId.\n        if (providerId && providerId !== targetProviderId) {\n            this.logger.error(\"Downstream target message did not match target provider id. Not sending message.\", {\n                connectionId,\n                targetProviderId,\n                actualProviderId: providerId,\n                message: sanitizeDownstreamMessage(message),\n            });\n            return;\n        }\n        if (channelData.type === \"iframe\") {\n            channelData.port.postMessage(message);\n        }\n        else {\n            channelData.sendDownstreamMessage(message);\n        }\n    }\n    /**\n     * Handles closing a child channel and performs appropriate cleanup.\n     *\n     * For MessagePort channels, removes event listeners and closes the port.\n     * For Direct channels, simply removes the channel from the internal map\n     * since no port cleanup is needed. The channel is always removed from\n     * the channels map regardless of type.\n     *\n     * @param params - Close message parameters\n     * @param params.connectionId - UUID of the channel to close\n     *\n     * @example\n     * ```typescript\n     * channelManager.handleCloseMessage({\n     *   connectionId: \"550e8400-e29b-41d4-a716-446655440000\"\n     * });\n     * ```\n     */\n    handleCloseMessage({ connectionId }) {\n        const channelData = this.channels.get(connectionId);\n        if (!channelData) {\n            this.logger.warn(\"Attempted to close child channel that was not found\", {\n                connectionId,\n            });\n            return;\n        }\n        if (channelData.type === \"iframe\") {\n            const { port, handler } = channelData;\n            port.removeEventListener(\"message\", handler);\n            port.close();\n        }\n        // For component channels, no cleanup of ports/handlers is needed\n        this.channels.delete(connectionId);\n        this.logger.debug(\"Removed child channel\", {\n            connectionId,\n            type: channelData.type,\n        });\n    }\n    createMessageHandler(connectionId, providerId) {\n        return (message) => this.relayChildUpstreamMessage({\n            type: \"childUpstream\",\n            sourceProviderId: providerId,\n            parentProviderId: this.provider.id,\n            connectionId,\n            message: message.data,\n        });\n    }\n}\n//# sourceMappingURL=channel-manager.js.map","import { ConnectLogger } from \"../../logging\";\nexport class ErrorService {\n    constructor(provider) {\n        this.errorHandlers = new Set();\n        this.logger = new ConnectLogger({\n            provider,\n            source: \"core.proxy.error\",\n        });\n    }\n    invoke(error) {\n        const { message, key, details, isFatal, connectionStatus } = error;\n        this.logger.error(message, {\n            key,\n            details,\n            isFatal,\n            connectionStatus,\n        }, { duplicateMessageToConsole: true, remoteIgnore: true });\n        [...this.errorHandlers].forEach((handler) => {\n            try {\n                handler(error);\n            }\n            catch (handlerError) {\n                this.logger.error(\"An error occurred within a AmazonConnectErrorHandler\", {\n                    handlerError,\n                    originalError: error,\n                });\n            }\n        });\n    }\n    onError(handler) {\n        this.errorHandlers.add(handler);\n    }\n    offError(handler) {\n        this.errorHandlers.delete(handler);\n    }\n}\n//# sourceMappingURL=error-service.js.map","import { ConnectLogger } from \"../../logging\";\nimport { AsyncEventEmitter } from \"../../utility\";\nexport class HealthCheckManager {\n    constructor({ provider, sendHealthCheck, getUpstreamMessageOrigin, }) {\n        this.connectionId = null;\n        this.healthCheckInterval = null;\n        this.healthCheckTimeout = null;\n        this.sendHealthCheck = sendHealthCheck;\n        this.getUpstreamMessageOrigin = getUpstreamMessageOrigin;\n        this.sendHealthCheckInterval = null;\n        this.lastHealthCheckResponse = null;\n        this._status = \"unknown\";\n        this.logger = new ConnectLogger({\n            source: \"core.proxy.health-check\",\n            provider: provider,\n            mixin: () => ({\n                connectionId: this.connectionId,\n            }),\n        });\n        this.events = new AsyncEventEmitter({\n            provider,\n            loggerKey: \"core.proxy.health-check\",\n        });\n    }\n    get status() {\n        return this._status;\n    }\n    get isRunning() {\n        return this.sendHealthCheckInterval !== null;\n    }\n    get lastCheckCounter() {\n        var _a, _b;\n        return (_b = (_a = this.lastHealthCheckResponse) === null || _a === void 0 ? void 0 : _a.counter) !== null && _b !== void 0 ? _b : null;\n    }\n    get lastCheckTime() {\n        var _a, _b;\n        return (_b = (_a = this.lastHealthCheckResponse) === null || _a === void 0 ? void 0 : _a.time) !== null && _b !== void 0 ? _b : null;\n    }\n    start({ healthCheckInterval: interval, connectionId, }) {\n        this.connectionId = connectionId;\n        this.healthCheckInterval = interval;\n        this.clearInterval();\n        if (interval <= 0) {\n            this.logger.debug(\"Health check disabled\");\n            return;\n        }\n        if (interval < 1000) {\n            this.logger.error(\"Health check interval is less than 1 second. Not running\", { interval });\n            return;\n        }\n        this.sendHealthCheckMessage();\n        this.sendHealthCheckInterval = setInterval(() => this.sendHealthCheckMessage(), interval);\n        this.startTimeout();\n    }\n    stop() {\n        this.clearInterval();\n        this.clearTimeout();\n    }\n    handleResponse(message) {\n        this.setHealthy({\n            time: message.time,\n            counter: message.counter,\n        });\n    }\n    sendHealthCheckMessage() {\n        this.sendHealthCheck({\n            type: \"healthCheck\",\n            messageOrigin: this.getUpstreamMessageOrigin(),\n        });\n    }\n    startTimeout() {\n        if (!this.healthCheckInterval) {\n            this.logger.error(\"Health check interval not set. Cannot start timeout\");\n            return;\n        }\n        // Cancels a preexisting timeout to be replaced with new timeout\n        this.clearTimeout();\n        this.healthCheckTimeout = setTimeout(() => {\n            this.setUnhealthy();\n        }, this.healthCheckInterval * 3);\n    }\n    clearInterval() {\n        if (this.sendHealthCheckInterval) {\n            clearInterval(this.sendHealthCheckInterval);\n            this.sendHealthCheckInterval = null;\n        }\n    }\n    clearTimeout() {\n        if (this.healthCheckTimeout) {\n            clearTimeout(this.healthCheckTimeout);\n            this.healthCheckTimeout = null;\n        }\n    }\n    setUnhealthy() {\n        if (this._status !== \"unhealthy\") {\n            const previousStatus = this._status;\n            this.logger.info(\"Connection unhealthy\", {\n                previousStatus,\n            });\n            this._status = \"unhealthy\";\n            this.emitStatusChanged(\"unhealthy\", previousStatus);\n        }\n    }\n    setHealthy(result) {\n        this.lastHealthCheckResponse = Object.assign({}, result);\n        if (this._status !== \"healthy\") {\n            const previousStatus = this._status;\n            this.logger.debug(\"Connection healthy\", {\n                previousStatus,\n            });\n            this._status = \"healthy\";\n            this.emitStatusChanged(\"healthy\", previousStatus);\n        }\n        this.startTimeout();\n    }\n    emitStatusChanged(status, previousStatus) {\n        var _a, _b, _c, _d;\n        void this.events.emit(HealthCheckManager.statusChangedKey, {\n            status,\n            previousStatus,\n            lastCheckTime: (_b = (_a = this.lastHealthCheckResponse) === null || _a === void 0 ? void 0 : _a.time) !== null && _b !== void 0 ? _b : null,\n            lastCheckCounter: (_d = (_c = this.lastHealthCheckResponse) === null || _c === void 0 ? void 0 : _c.counter) !== null && _d !== void 0 ? _d : null,\n        });\n    }\n    onStatusChanged(handler) {\n        this.events.on(HealthCheckManager.statusChangedKey, handler);\n    }\n    offStatusChanged(handler) {\n        this.events.off(HealthCheckManager.statusChangedKey, handler);\n    }\n}\nHealthCheckManager.statusChangedKey = \"statusChanged\";\n//# sourceMappingURL=health-check-manager.js.map","import { ConnectLogger } from \"../../logging\";\nexport class ProxyConnectionStatusManager {\n    constructor(provider) {\n        this.status = \"notConnected\";\n        this.changeHandlers = new Set();\n        this.logger = new ConnectLogger({\n            source: \"core.proxy.connection-status-manager\",\n            provider,\n            mixin: () => ({ status: this.status }),\n        });\n    }\n    getStatus() {\n        return this.status;\n    }\n    update(evt) {\n        this.status = evt.status;\n        this.logger.trace(\"Proxy Connection Status Changed\", {\n            status: evt.status,\n        });\n        [...this.changeHandlers].forEach((handler) => {\n            try {\n                handler(evt);\n            }\n            catch (error) {\n                this.logger.error(\"An error occurred within a ProxyConnectionChangedHandler\", { error });\n            }\n        });\n    }\n    onChange(handler) {\n        this.changeHandlers.add(handler);\n    }\n    offChange(handler) {\n        this.changeHandlers.delete(handler);\n    }\n}\n//# sourceMappingURL=proxy-connection-status-manager.js.map","var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __rest = (this && this.__rest) || function (s, e) {\n    var t = {};\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\n        t[p] = s[p];\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\n                t[p[i]] = s[p[i]];\n        }\n    return t;\n};\nimport { ConnectLogger, createLogMessage, } from \"../logging\";\nimport { SubscriptionManager, } from \"../messaging/subscription\";\nimport { createMetricMessage } from \"../metric\";\nimport { createRequestMessage, RequestManager, } from \"../request\";\nimport { ChannelManager } from \"./channel-manager\";\nimport { ErrorService } from \"./error\";\nimport { HealthCheckManager, } from \"./health-check\";\nimport { ProxyConnectionStatusManager, } from \"./proxy-connection\";\nexport class Proxy {\n    constructor(provider) {\n        this.provider = provider;\n        this.logger = new ConnectLogger({\n            source: \"core.proxy\",\n            provider,\n            mixin: () => ({\n                proxyType: this.proxyType,\n                connectionId: this.connectionId,\n            }),\n        });\n        this.requestManager = new RequestManager(provider);\n        this.status = new ProxyConnectionStatusManager(provider);\n        this.errorService = new ErrorService(provider);\n        this.upstreamMessageQueue = [];\n        this.connectionEstablished = false;\n        this.isInitialized = false;\n        this.subscriptions = new SubscriptionManager();\n        this.connectionId = null;\n        this.channelManager = new ChannelManager(provider, this.sendOrQueueMessageToSubject.bind(this));\n        this.healthCheck = new HealthCheckManager({\n            provider,\n            sendHealthCheck: this.sendOrQueueMessageToSubject.bind(this),\n            getUpstreamMessageOrigin: this.getUpstreamMessageOrigin.bind(this),\n        });\n    }\n    init() {\n        if (this.isInitialized)\n            throw new Error(\"Proxy already initialized\");\n        this.isInitialized = true;\n        this.initProxy();\n    }\n    request(namespace, command, data, origin) {\n        const msg = createRequestMessage(namespace, command, data, origin !== null && origin !== void 0 ? origin : this.getUpstreamMessageOrigin());\n        const resp = this.requestManager.processRequest(msg);\n        this.sendOrQueueMessageToSubject(msg);\n        return resp;\n    }\n    subscribe(topic, handler, origin) {\n        const { handlerId } = this.subscriptions.add(topic, handler);\n        const msg = {\n            type: \"subscribe\",\n            topic,\n            messageOrigin: origin !== null && origin !== void 0 ? origin : this.getUpstreamMessageOrigin(),\n            handlerId,\n        };\n        this.sendOrQueueMessageToSubject(msg);\n    }\n    unsubscribe(topic, handler, origin) {\n        this.subscriptions.delete(topic, handler);\n        if (this.subscriptions.isEmpty(topic)) {\n            const msg = {\n                type: \"unsubscribe\",\n                topic,\n                messageOrigin: origin !== null && origin !== void 0 ? origin : this.getUpstreamMessageOrigin(),\n            };\n            this.sendOrQueueMessageToSubject(msg);\n        }\n    }\n    log(logData) {\n        const logMsg = createLogMessage(logData, this.addContextToLogger(), this.getUpstreamMessageOrigin());\n        this.sendOrQueueMessageToSubject(logMsg);\n    }\n    sendLogMessage(message) {\n        if (message.type !== \"log\") {\n            this.logger.error(\"Attempted to send invalid log message\", {\n                message,\n            });\n            return;\n        }\n        message.context = Object.assign(Object.assign({}, message.context), this.addContextToLogger());\n        this.sendOrQueueMessageToSubject(message);\n    }\n    sendMetric({ metricData, time, namespace }) {\n        const metricMessage = createMetricMessage({\n            metricData,\n            time,\n            namespace,\n        }, this.getUpstreamMessageOrigin());\n        this.sendOrQueueMessageToSubject(metricMessage);\n    }\n    sendMetricMessage(metricMessage) {\n        if (metricMessage.type !== \"metric\") {\n            this.logger.error(\"Attempted to send invalid metric message\", {\n                metricMessage,\n            });\n            return;\n        }\n        this.sendOrQueueMessageToSubject(metricMessage);\n    }\n    sendOrQueueMessageToSubject(message) {\n        if (this.connectionEstablished) {\n            this.sendMessageToSubject(message);\n        }\n        else {\n            this.upstreamMessageQueue.push(message);\n        }\n    }\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    consumerMessageHandler(evt) {\n        if (!this.isInitialized) {\n            this.logger.error(\"Attempted to process message from subject prior to proxy being initializing. Message not processed\", { originalMessageEventData: evt.data });\n            return;\n        }\n        // eslint-disable-next-line @typescript-eslint/no-unsafe-assignment\n        const { data } = evt;\n        if (!(\"type\" in data)) {\n            // TODO Clean this up... probably safe to ignore without logging\n            this.logger.warn(\"Unknown inbound message\", {\n                originalMessageEventData: data,\n            });\n            return;\n        }\n        // Naming of type confusing because outbound to worker is inbound to client\n        const msg = data;\n        this.handleMessageFromSubject(msg);\n    }\n    handleMessageFromSubject(msg) {\n        this.handleDefaultMessageFromSubject(msg);\n    }\n    handleDefaultMessageFromSubject(msg) {\n        switch (msg.type) {\n            case \"acknowledge\":\n                this.handleConnectionAcknowledge(msg);\n                break;\n            case \"response\":\n                this.handleResponse(msg);\n                break;\n            case \"publish\":\n                this.handlePublish(msg);\n                break;\n            case \"error\":\n                this.handleError(msg);\n                break;\n            case \"childDownstreamMessage\":\n                this.channelManager.handleDownstreamMessage(msg);\n                break;\n            case \"childConnectionClose\":\n                this.channelManager.handleCloseMessage(msg);\n                break;\n            case \"healthCheckResponse\":\n                this.healthCheck.handleResponse(msg);\n                break;\n            default:\n                this.logger.error(\"Unknown inbound message\", {\n                    originalMessageEventData: msg,\n                });\n                return;\n        }\n    }\n    handleConnectionAcknowledge(msg) {\n        this.connectionId = msg.connectionId;\n        this.logger.debug(\"Connection acknowledged by subject\", {\n            connectionId: msg.connectionId,\n            queuedMessageCount: this.upstreamMessageQueue.length,\n            status: msg.status,\n        });\n        this.status.update({\n            status: \"ready\",\n            connectionId: msg.connectionId,\n        });\n        this.connectionEstablished = true;\n        // Sends any messages in queue\n        while (this.upstreamMessageQueue.length) {\n            const msg = this.upstreamMessageQueue.shift();\n            this.sendMessageToSubject(msg);\n        }\n        this.healthCheck.start(msg);\n        this.logger.debug(\"Proxy connection ready\", {\n            connectionId: this.connectionId,\n        });\n    }\n    handleResponse(msg) {\n        this.requestManager.processResponse(msg);\n    }\n    handlePublish(msg) {\n        const { handlerId, topic } = msg;\n        if (handlerId) {\n            const handler = this.subscriptions.getById(topic, handlerId);\n            if (handler) {\n                void this.handleAsyncSubscriptionHandlerInvoke({ handler, handlerId }, msg);\n            }\n        }\n        else {\n            this.subscriptions\n                .get(topic)\n                .map((handlerIdMapping) => void this.handleAsyncSubscriptionHandlerInvoke(handlerIdMapping, msg));\n        }\n    }\n    handleError(msg) {\n        if (msg.isFatal) {\n            const { message: reason, type: _ } = msg, details = __rest(msg, [\"message\", \"type\"]);\n            this.status.update({ status: \"error\", reason: reason, details });\n        }\n        this.publishError({\n            message: msg.message,\n            key: msg.key,\n            details: msg.details,\n            isFatal: msg.isFatal,\n            proxyStatus: msg.status,\n        });\n    }\n    publishError(error) {\n        const fullError = Object.assign(Object.assign({}, error), { connectionStatus: this.connectionStatus });\n        this.errorService.invoke(fullError);\n    }\n    handleAsyncSubscriptionHandlerInvoke(_a, _b) {\n        return __awaiter(this, arguments, void 0, function* ({ handler, handlerId }, { topic, data }) {\n            try {\n                yield handler(data);\n            }\n            catch (error) {\n                this.logger.error(\"An error occurred when handling subscription\", {\n                    topic,\n                    error,\n                    handlerId,\n                });\n            }\n        });\n    }\n    get connectionStatus() {\n        return this.status.getStatus();\n    }\n    onError(handler) {\n        this.errorService.onError(handler);\n    }\n    offError(handler) {\n        this.errorService.offError(handler);\n    }\n    onConnectionStatusChange(handler) {\n        this.status.onChange(handler);\n    }\n    offConnectionStatusChange(handler) {\n        this.status.offChange(handler);\n    }\n    onHealthCheckStatusChanged(handler) {\n        this.healthCheck.onStatusChanged(handler);\n    }\n    offHealthCheckStatusChanged(handler) {\n        this.healthCheck.offStatusChanged(handler);\n    }\n    /**\n     * @deprecated Use addChildIframeChannel instead. This method will be removed in a future version.\n     */\n    addChildChannel(params) {\n        // Legacy method that only supports MessagePort channels\n        this.addChildIframeChannel(params);\n    }\n    /**\n     * Adds a component-based child channel to the proxy.\n     *\n     * This method establishes a communication channel using component function calls instead\n     * of MessagePorts. This is useful when both the proxy and child entity exist in the same\n     * execution context, such as within the same browser window or iframe.\n     *\n     * Component channels provide better performance than iframe channels since they avoid\n     * the overhead of serialization and can support synchronous communication patterns.\n     *\n     * @param params - Component channel configuration\n     * @param params.connectionId - UUID identifier for this channel connection\n     * @param params.providerId - UUID of the provider that owns this channel\n     * @param params.sendDownstreamMessage - Function to send messages to the child entity\n     * @param params.setUpstreamMessageHandler - Function to register upstream message handler\n     *\n     * @example\n     * ```typescript\n     * proxy.addChildComponentChannel({\n     *   connectionId: \"child-uuid\",\n     *   providerId: \"provider-uuid\",\n     *   sendDownstreamMessage: (message) => childComponent.receive(message),\n     *   setUpstreamMessageHandler: (handler) => childComponent.onUpstream = handler\n     * });\n     * ```\n     */\n    addChildIframeChannel(params) {\n        this.channelManager.addChannel(Object.assign(Object.assign({}, params), { type: \"iframe\" }));\n    }\n    /**\n     * Adds a component-based child channel for communication with child entities.\n     *\n     * This method establishes a communication channel using direct function calls instead\n     * of MessagePorts. This is useful when both the proxy and child entity exist in the same\n     * execution context and can directly reference each other's functions.\n     *\n     * @param params - Configuration parameters for the component function channel\n     * @param params.connectionId - Unique UUID identifier for this channel connection\n     * @param params.providerId - UUID of the provider that owns this channel connection\n     * @param params.sendDownstreamMessage - Function to send messages from proxy to child entity\n     * @param params.setUpstreamMessageHandler - Function to register handler for messages from child entity\n     *\n     * @example\n     * ```typescript\n     * // Child entity exposes these functions\n     * const childAPI = {\n     *   receive: (message) => { },\n     *   onUpstream: null as ((message) => void) | null\n     * };\n     *\n     * proxy.addChildComponentChannel({\n     *   connectionId: \"550e8400-e29b-41d4-a716-446655440001\", // UUID\n     *   providerId: \"6ba7b810-9dad-11d1-80b4-00c04fd430c8\", // UUID\n     *   sendDownstreamMessage: (message) => {\n     *     childAPI.receive(message);\n     *   },\n     *   setUpstreamMessageHandler: (handler) => {\n     *     childAPI.onUpstream = handler;\n     *   }\n     * });\n     * ```\n     */\n    addChildComponentChannel(params) {\n        this.channelManager.addChannel(Object.assign(Object.assign({}, params), { type: \"component\" }));\n    }\n    /**\n     * Updates an existing iframe channel with a new MessagePort.\n     *\n     * This method is only applicable to iframe channels. Component channels cannot\n     * be updated and will result in an error. The old MessagePort is properly cleaned up\n     * (event listeners removed, port closed) before the new port is configured.\n     *\n     * @param params - Update parameters\n     * @param params.connectionId - UUID identifier for the channel to update\n     * @param params.port - New MessagePort instance to replace the existing one\n     * @param params.providerId - UUID of the provider that owns this channel\n     *\n     * @example\n     * ```typescript\n     * const { port1, port2 } = new MessageChannel();\n     * proxy.updateChildIframeChannelPort({\n     *   connectionId: \"550e8400-e29b-41d4-a716-446655440000\",\n     *   port: port1,\n     *   providerId: \"6ba7b810-9dad-11d1-80b4-00c04fd430c8\"\n     * });\n     * ```\n     */\n    updateChildIframeChannelPort(params) {\n        this.channelManager.updateChannelPort(params);\n    }\n    /**\n     * @deprecated Use updateChildIframeChannelPort instead. This method will be removed in a future version.\n     */\n    updateChildChannelPort(params) {\n        this.updateChildIframeChannelPort(params);\n    }\n    getConnectionId() {\n        if (this.connectionId)\n            return Promise.resolve(this.connectionId);\n        return new Promise((resolve, reject) => {\n            let timeout = undefined;\n            const handler = (evt) => {\n                if (evt.status === \"ready\") {\n                    this.offConnectionStatusChange(handler);\n                    clearInterval(timeout);\n                    resolve(evt.connectionId);\n                }\n            };\n            timeout = setTimeout(() => {\n                this.logger.error(\"Timeout getting connection id\");\n                this.offConnectionStatusChange(handler);\n                reject(new Error(\"Timeout getting connectionId\"));\n            }, 10 * 1000);\n            this.onConnectionStatusChange(handler);\n        });\n    }\n    resetConnection(reason) {\n        this.logger.debug(\"Resetting connection\", {\n            reason,\n            connectionId: this.connectionId,\n        });\n        this.connectionEstablished = false;\n        this.status.update({\n            status: \"reset\",\n            reason,\n        });\n        const { subscriptionHandlerCount } = this.restoreAllHandler();\n        this.logger.info(\"Resetting proxy\", {\n            reason,\n            subscriptionHandlerCount,\n        });\n        this.logger.debug(\"Connection reset complete, restoring handlers\", {\n            subscriptionHandlerCount,\n        });\n    }\n    restoreAllHandler() {\n        var _a;\n        const subscriptionHandlerIds = this.subscriptions.getAllSubscriptionHandlerIds();\n        // Restore all subscriptions\n        subscriptionHandlerIds === null || subscriptionHandlerIds === void 0 ? void 0 : subscriptionHandlerIds.map(({ topic, handlerId }) => ({\n            type: \"subscribe\",\n            topic,\n            messageOrigin: this.getUpstreamMessageOrigin(),\n            handlerId,\n        })).forEach((msg) => this.sendOrQueueMessageToSubject(msg));\n        return { subscriptionHandlerCount: (_a = subscriptionHandlerIds === null || subscriptionHandlerIds === void 0 ? void 0 : subscriptionHandlerIds.length) !== null && _a !== void 0 ? _a : -1 };\n    }\n    unsubscribeAllHandlers() {\n        var _a;\n        const subscriptionHandlerIds = this.subscriptions.getAllSubscriptionHandlerIds();\n        this.logger.info(\"Unsubscribing all handlers from proxy\", {\n            subscriptionHandlerCount: (_a = subscriptionHandlerIds === null || subscriptionHandlerIds === void 0 ? void 0 : subscriptionHandlerIds.length) !== null && _a !== void 0 ? _a : -1,\n        });\n        subscriptionHandlerIds === null || subscriptionHandlerIds === void 0 ? void 0 : subscriptionHandlerIds.map(({ topic }) => ({\n            type: \"unsubscribe\",\n            topic,\n            messageOrigin: this.getUpstreamMessageOrigin(),\n        })).forEach((msg) => this.sendOrQueueMessageToSubject(msg));\n    }\n}\n//# sourceMappingURL=proxy.js.map","import { ConnectLogger } from \"../logging\";\nexport class TimeoutTracker {\n    constructor(onCancelled, timeoutMs) {\n        this.timeoutMs = timeoutMs;\n        this.onCancelled = onCancelled;\n        this.timeout = setTimeout(() => this.handleCancel(), this.timeoutMs);\n        this.status = \"running\";\n        this.logger = new ConnectLogger({\n            source: \"core.utility.timeout-tracker\",\n            mixin: () => ({\n                timeoutMs: this.timeoutMs,\n                timeoutTrackerStatus: this.status,\n            }),\n        });\n    }\n    static start(onCancelled, ms) {\n        return new TimeoutTracker(onCancelled, ms);\n    }\n    complete() {\n        switch (this.status) {\n            case \"running\":\n                return this.handleComplete();\n            case \"completed\":\n                this.logger.debug(\"TimeoutTracker already marked complete. No action.\");\n                return true;\n            case \"cancelled\":\n                this.logger.info(\"Attempted to complete a TimeoutTracker that has already been cancelled\");\n                return false;\n        }\n    }\n    isCancelled() {\n        return this.status === \"cancelled\";\n    }\n    getStatus() {\n        return this.status;\n    }\n    handleCancel() {\n        switch (this.status) {\n            case \"running\":\n                this.status = \"cancelled\";\n                this.logger.info(\"TimeoutTracker has timed out. Invoking onCancelled Handler\");\n                this.invokeOnCancelled();\n                break;\n            case \"completed\":\n                this.logger.debug(\"Cancel operation for TimerTracker invoked after already completed. No action.\");\n                break;\n            default:\n                throw new Error(\"Cancel operation in TimerTracker called during an unexpected time.\");\n        }\n    }\n    handleComplete() {\n        this.status = \"completed\";\n        clearTimeout(this.timeout);\n        return true;\n    }\n    invokeOnCancelled() {\n        try {\n            this.onCancelled({ timeoutMs: this.timeoutMs });\n        }\n        catch (error) {\n            this.logger.error(\"Error when attempting to invoke TimeoutTrackerCancelledHandler\", { error });\n        }\n    }\n}\n//# sourceMappingURL=timeout-tracker.js.map","export var LogLevel;\n(function (LogLevel) {\n    LogLevel[LogLevel[\"trace\"] = 1] = \"trace\";\n    LogLevel[LogLevel[\"debug\"] = 2] = \"debug\";\n    LogLevel[LogLevel[\"info\"] = 3] = \"info\";\n    LogLevel[LogLevel[\"warn\"] = 4] = \"warn\";\n    LogLevel[LogLevel[\"error\"] = 5] = \"error\";\n})(LogLevel || (LogLevel = {}));\n//# sourceMappingURL=log-level.js.map","/* eslint-disable no-console */\nimport { LogLevel } from \"./log-level\";\nexport function logToConsole(level, message, data) {\n    if (data) {\n        switch (level) {\n            case LogLevel.error:\n                console.error(message, data);\n                break;\n            case LogLevel.warn:\n                console.warn(message, data);\n                break;\n            case LogLevel.info:\n                console.info(message, data);\n                break;\n            case LogLevel.debug:\n                console.debug(message, data);\n                break;\n            case LogLevel.trace:\n                console.trace(message, data);\n                break;\n            default:\n                console.log(message, data);\n                break;\n        }\n    }\n    else {\n        switch (level) {\n            case LogLevel.error:\n                console.error(message);\n                break;\n            case LogLevel.warn:\n                console.warn(message);\n                break;\n            case LogLevel.info:\n                console.info(message);\n                break;\n            case LogLevel.debug:\n                console.debug(message);\n                break;\n            case LogLevel.trace:\n                console.trace(message);\n                break;\n            default:\n                console.log(message);\n                break;\n        }\n    }\n}\n//# sourceMappingURL=log-data-console-writer.js.map","export class LogDataTransformer {\n    constructor(mixin) {\n        this.mixin = mixin;\n    }\n    getTransformedData(level, data) {\n        if (!this.mixin)\n            return data;\n        return Object.assign(Object.assign({}, (data !== null && data !== void 0 ? data : {})), this.mixin(data !== null && data !== void 0 ? data : {}, level));\n    }\n}\n//# sourceMappingURL=log-data-transformer.js.map","import { getGlobalProvider } from \"../provider\";\nimport { generateStringId } from \"../utility\";\nimport { logToConsole } from \"./log-data-console-writer\";\nimport { LogDataTransformer } from \"./log-data-transformer\";\nimport { LogLevel } from \"./log-level\";\nexport class ConnectLogger {\n    constructor(param) {\n        this._proxy = null;\n        this._logToConsoleLevel = null;\n        this.loggerId = generateStringId(8);\n        if (typeof param === \"string\") {\n            this.source = param;\n            this.dataTransformer = new LogDataTransformer(undefined);\n        }\n        else {\n            this.source = param.source;\n            if (param.provider && typeof param.provider === \"function\")\n                this.providerFactory = param.provider;\n            else\n                this.provider = param.provider;\n            this.dataTransformer = new LogDataTransformer(param.mixin);\n            this.logOptions = param.options;\n        }\n    }\n    trace(message, data, options) {\n        this.log(LogLevel.trace, message, data, options);\n    }\n    debug(message, data, options) {\n        this.log(LogLevel.debug, message, data, options);\n    }\n    info(message, data, options) {\n        this.log(LogLevel.info, message, data, options);\n    }\n    warn(message, data, options) {\n        this.log(LogLevel.warn, message, data, options);\n    }\n    error(message, data, options) {\n        this.log(LogLevel.error, message, data, options);\n    }\n    log(level, message, data, options) {\n        const transformedData = this.dataTransformer.getTransformedData(level, data);\n        if (!this.ignoreRemote(options)) {\n            this.getProxy().log({\n                level,\n                source: this.source,\n                loggerId: this.loggerId,\n                message,\n                data: transformedData,\n            });\n        }\n        if (this.applyDuplicateMessageToConsole(level, options)) {\n            logToConsole(level, message, transformedData);\n        }\n    }\n    getProvider() {\n        if (!this.provider) {\n            this.provider = this.providerFactory\n                ? this.providerFactory()\n                : getGlobalProvider();\n        }\n        return this.provider;\n    }\n    getProxy() {\n        if (!this._proxy) {\n            this._proxy = this.getProvider().getProxy();\n        }\n        return this._proxy;\n    }\n    applyDuplicateMessageToConsole(level, options) {\n        return ((options === null || options === void 0 ? void 0 : options.duplicateMessageToConsole) || this.getLogConsoleLevel() <= level);\n    }\n    getLogConsoleLevel() {\n        var _a, _b, _c, _d;\n        if (!this._logToConsoleLevel) {\n            this._logToConsoleLevel = ((_a = this.logOptions) === null || _a === void 0 ? void 0 : _a.minLogToConsoleLevelOverride)\n                ? this.logOptions.minLogToConsoleLevelOverride\n                : ((_d = (_c = (_b = this.getProvider().config) === null || _b === void 0 ? void 0 : _b.logging) === null || _c === void 0 ? void 0 : _c.minLogToConsoleLevel) !== null && _d !== void 0 ? _d : LogLevel.error);\n        }\n        return this._logToConsoleLevel;\n    }\n    ignoreRemote(options) {\n        var _a, _b, _c;\n        return (((_b = (_a = this.logOptions) === null || _a === void 0 ? void 0 : _a.remoteIgnore) !== null && _b !== void 0 ? _b : false) ||\n            ((_c = options === null || options === void 0 ? void 0 : options.remoteIgnore) !== null && _c !== void 0 ? _c : false));\n    }\n}\n//# sourceMappingURL=connect-logger.js.map","import { deepClone } from \"../utility/deep-clone\";\nexport function sanitizeData(data) {\n    if (!data)\n        return undefined;\n    try {\n        return deepClone(data);\n    }\n    catch (_a) {\n        return {\n            error: \"Data failed to sanitize. The original data is not available\",\n        };\n    }\n}\n//# sourceMappingURL=sanitize-data.js.map","import { sanitizeData } from \"./sanitize-data\";\nexport function createLogMessage({ level, source, message, loggerId, data }, context, messageOrigin) {\n    // Sanitize guards against a caller provided data object containing a\n    // non-cloneable object which will fail if sent through a message channel\n    const sanitizedData = sanitizeData(data);\n    return {\n        type: \"log\",\n        level,\n        time: new Date(),\n        source,\n        message,\n        loggerId,\n        data: sanitizedData,\n        context,\n        messageOrigin,\n    };\n}\n//# sourceMappingURL=log-message-factory.js.map","import { ConnectError } from \"../error\";\nimport { ConnectLogger } from \"../logging\";\nimport { generateUUID } from \"../utility\";\nimport { getGlobalProvider, setGlobalProvider } from \"./global-provider\";\nexport class AmazonConnectProviderBase {\n    constructor({ config, proxyFactory }) {\n        this._id = generateUUID();\n        if (!proxyFactory) {\n            throw new Error(\"Attempted to get Proxy before setting up factory\");\n        }\n        if (!config) {\n            throw new Error(\"Failed to include config\");\n        }\n        this.proxyFactory = proxyFactory;\n        this._config = config;\n    }\n    get id() {\n        return this._id;\n    }\n    getProxy() {\n        if (!this.proxy) {\n            this.proxy = this.proxyFactory(this);\n            this.proxy.init();\n        }\n        return this.proxy;\n    }\n    get config() {\n        return Object.assign({}, this._config);\n    }\n    onError(handler) {\n        this.getProxy().onError(handler);\n    }\n    offError(handler) {\n        this.getProxy().offError(handler);\n    }\n    static initializeProvider(provider) {\n        if (this.isInitialized) {\n            const msg = \"Attempted to initialize provider more than one time.\";\n            const details = {};\n            try {\n                // Attempts to get the existing provider for logging\n                const existingProvider = getGlobalProvider();\n                const logger = new ConnectLogger({\n                    source: \"core.amazonConnectProvider.init\",\n                    provider: existingProvider,\n                });\n                logger.error(msg);\n            }\n            catch (e) {\n                // In the event of a error when logging or attempting\n                // to get provider when logging, capture the message\n                // in the error being thrown\n                details.loggingError = e === null || e === void 0 ? void 0 : e.message;\n            }\n            throw new ConnectError({\n                errorKey: \"attemptInitializeMultipleProviders\",\n                reason: msg,\n                details,\n            });\n        }\n        setGlobalProvider(provider);\n        this.isInitialized = true;\n        // Getting the proxy sets up the connection with subject\n        provider.getProxy();\n        return provider;\n    }\n}\nAmazonConnectProviderBase.isInitialized = false;\n//# sourceMappingURL=provider-base.js.map","import { ConnectLogger } from \"../logging\";\nimport { ConnectMetricRecorder, } from \"../metric\";\nimport { createModuleProxy } from \"../proxy\";\nexport class ModuleContext {\n    constructor(engineContext, moduleNamespace) {\n        this.engineContext = engineContext;\n        this.moduleNamespace = moduleNamespace;\n    }\n    get proxy() {\n        if (!this.moduleProxy) {\n            const proxy = this.engineContext.getProvider().getProxy();\n            const moduleNamespace = this.moduleNamespace;\n            this.moduleProxy = createModuleProxy(proxy, moduleNamespace);\n        }\n        return this.moduleProxy;\n    }\n    getProvider() {\n        return this.engineContext.getProvider();\n    }\n    createLogger(params) {\n        if (typeof params === \"object\") {\n            return new ConnectLogger(Object.assign(Object.assign({}, params), { provider: () => this.engineContext.getProvider() }));\n        }\n        else {\n            return new ConnectLogger({\n                source: params,\n                provider: () => this.engineContext.getProvider(),\n            });\n        }\n    }\n    createMetricRecorder(params) {\n        if (typeof params === \"object\") {\n            return new ConnectMetricRecorder(Object.assign(Object.assign({}, params), { provider: () => this.engineContext.getProvider() }));\n        }\n        else {\n            return new ConnectMetricRecorder({\n                namespace: params,\n                provider: () => this.engineContext.getProvider(),\n            });\n        }\n    }\n}\n//# sourceMappingURL=module-context.js.map","import { getGlobalProvider } from \"../provider\";\nimport { ModuleContext } from \"./module-context\";\nexport class Context {\n    constructor(provider) {\n        this._provider = provider;\n    }\n    getProvider() {\n        if (this._provider)\n            return this._provider;\n        else\n            return getGlobalProvider();\n    }\n    getModuleContext(namespace) {\n        return new ModuleContext(this, namespace);\n    }\n}\n//# sourceMappingURL=context.js.map","// Do not edit this file manually\nexport const sdkVersion = \"1.0.9\";\n//# sourceMappingURL=sdk-version.js.map","import { Context } from \"@amazon-connect/core\";\nexport class AppContext extends Context {\n    constructor({ provider, instanceId, config, parameters, contactScope, scope, launchedBy, }) {\n        super(provider);\n        this.appInstanceId = instanceId;\n        this.instanceId = instanceId;\n        this.config = config;\n        this.appConfig = config;\n        this.contactScope = contactScope;\n        this.scope = scope;\n        this.parameters = parameters;\n        this.launchedBy =\n            launchedBy !== null && launchedBy !== void 0 ? launchedBy : {\n                // Not a valid type, but launchedBy will always been provided\n                // in practice for apps\n                type: \"unknown\",\n            };\n    }\n}\n//# sourceMappingURL=app-context.js.map","var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nimport { ConnectLogger } from \"@amazon-connect/core\";\nexport class LifecycleManager {\n    constructor(provider) {\n        this.provider = provider;\n        this.state = { isRunning: false };\n        this.isCreated = false;\n        this.isDestroyed = false;\n        this.logger = new ConnectLogger({\n            source: \"app.lifecycleManager\",\n            provider,\n            mixin: () => ({\n                state: this.state,\n                isCreated: this.isCreated,\n                isDestroyed: this.isDestroyed,\n            }),\n        });\n    }\n    get appState() {\n        return Object.assign({}, this.state);\n    }\n    handleCreate(params) {\n        return __awaiter(this, void 0, void 0, function* () {\n            var _a;\n            if (this.isDestroyed) {\n                this.logger.error(\"An attempt was Create after a Destroy. No Action\", {\n                    instanceId: params.context.instanceId,\n                });\n                return;\n            }\n            if (this.isCreated) {\n                this.logger.error(\"An attempt was invoke Create after it was already invoked. No Action\", { instanceId: params.context.instanceId });\n                return;\n            }\n            this.logger.debug(\"Begin Lifecycle Create\", {\n                instanceId: params.context.instanceId,\n            });\n            if (!((_a = this.provider.config) === null || _a === void 0 ? void 0 : _a.onCreate)) {\n                const msg = \"App did not specify an onCreated handler. This is required. Closing app\";\n                const data = {\n                    appInstanceId: params.context.instanceId,\n                    instanceId: params.context.instanceId,\n                };\n                this.logger.error(msg, { instanceId: params.context.instanceId });\n                this.provider.sendFatalError(msg, data);\n                return;\n            }\n            const { success } = yield this.handleLifecycleChange(Object.assign(Object.assign({}, params), { stage: \"create\" }), \n            // eslint-disable-next-line @typescript-eslint/no-unsafe-argument, @typescript-eslint/no-explicit-any\n            (e) => this.provider.config.onCreate(e), true);\n            if (success) {\n                this.isCreated = true;\n                this.sendLifecycleHandlerCompletedMessage(params.context.instanceId, \"create\");\n            }\n        });\n    }\n    handleLifecycleChange(evt, action, isFatal) {\n        return __awaiter(this, void 0, void 0, function* () {\n            let success = false;\n            try {\n                yield action(evt);\n                success = true;\n            }\n            catch (error) {\n                const { instanceId: instanceId } = evt.context;\n                if (isFatal) {\n                    const msg = `An fatal error occurred when handling a ${evt.stage} lifecycle action. Closing app`;\n                    this.logger.error(msg, { instanceId, error });\n                    this.provider.sendFatalError(msg, error);\n                }\n                else {\n                    this.logger.error(`An error occurred when handling a ${evt.stage} lifecycle action.`, {\n                        instanceId,\n                        error,\n                    });\n                }\n            }\n            return { success };\n        });\n    }\n    sendLifecycleHandlerCompletedMessage(appInstanceId, stage) {\n        this.logger.debug(`Sending lifecycle ${stage} completed signal`);\n        const proxy = this.provider.getProxy();\n        proxy.sendLifecycleHandlerCompleted(appInstanceId, stage);\n    }\n}\n//# sourceMappingURL=lifecycle-manager.js.map","var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nimport { AppContext } from \"../app-context\";\nimport { LifecycleManager, } from \"./lifecycle-manager\";\nexport class AppLifecycleManager extends LifecycleManager {\n    constructor(provider) {\n        super(provider);\n        this.startHandlers = new Set();\n        this.stopHandlers = new Set();\n    }\n    handleLifecycleChangeMessage(msg) {\n        const context = new AppContext({\n            provider: this.provider,\n            instanceId: msg.instanceId,\n            config: msg.config,\n            parameters: msg.parameters,\n            contactScope: msg.contactScope,\n            scope: msg.scope,\n            launchedBy: msg.launchedBy,\n        });\n        this.state.instanceId = msg.instanceId;\n        this.state.appInstanceId = msg.instanceId;\n        this.state.config = msg.config;\n        this.state.appConfig = msg.config;\n        this.state.contactScope = msg.contactScope;\n        const params = { context };\n        switch (msg.stage) {\n            case \"create\":\n                return this.handleCreate(params);\n            case \"start\":\n                return this.handleStart(params);\n            case \"stop\":\n                return this.handleStop(params);\n            case \"destroy\":\n                return this.handleDestroy(params);\n        }\n    }\n    onStart(handler, options) {\n        this.startHandlers.add(handler);\n        // Allows subscribers to get start information even if they add their\n        // subscription after the start event fires while app is running\n        if (options === null || options === void 0 ? void 0 : options.invokeIfRunning) {\n            if (this.state.isRunning) {\n                this.handleLifecycleChange(Object.assign(Object.assign({}, this.getAppLifecycleChangeParams()), { stage: \"start\" }), (e) => handler(e), false);\n            }\n        }\n    }\n    onStop(handler) {\n        this.stopHandlers.add(handler);\n    }\n    offStart(handler) {\n        this.startHandlers.delete(handler);\n    }\n    offStop(handler) {\n        this.stopHandlers.delete(handler);\n    }\n    handleStart(params) {\n        return __awaiter(this, void 0, void 0, function* () {\n            if (this.isDestroyed) {\n                this.logger.error(\"An attempt was Start after a Destroy. No Action\", {\n                    appInstanceId: params.context.instanceId,\n                });\n                return;\n            }\n            if (!this.isCreated) {\n                this.logger.error(\"An attempt was invoke Start before Create. No Action\", { appInstanceId: params.context.instanceId });\n                return;\n            }\n            this.state.isRunning = true;\n            this.logger.info(\"Begin Lifecycle Start\");\n            const handlerRunResult = yield Promise.all([...this.startHandlers].map((h) => this.handleLifecycleChange(Object.assign(Object.assign({}, params), { stage: \"start\" }), (e) => h(e), false)));\n            this.logger.debug(\"Completed all start handlers\", {\n                count: this.startHandlers.size,\n                errorCount: handlerRunResult.filter(({ success }) => !success).length,\n            });\n        });\n    }\n    handleStop(params) {\n        return __awaiter(this, void 0, void 0, function* () {\n            if (this.isDestroyed) {\n                this.logger.error(\"An attempt was Stop after a Destroy. No Action\", {\n                    appInstanceId: params.context.instanceId,\n                });\n                return;\n            }\n            if (!this.isCreated) {\n                this.logger.error(\"An attempt was invoke Stop before Create. No Action\", {\n                    appInstanceId: params.context.instanceId,\n                });\n                return;\n            }\n            this.state.isRunning = false;\n            this.logger.info(\"Begin Lifecycle Stop\");\n            const handlerRunResult = yield Promise.all([...this.stopHandlers].map((h) => this.handleLifecycleChange(Object.assign(Object.assign({}, params), { stage: \"stop\" }), (e) => h(e), false)));\n            this.logger.debug(\"Completed all stop handlers\", {\n                count: this.stopHandlers.size,\n                errorCount: handlerRunResult.filter(({ success }) => !success).length,\n            });\n        });\n    }\n    handleDestroy(params) {\n        return __awaiter(this, void 0, void 0, function* () {\n            if (this.isDestroyed) {\n                this.logger.error(\"An attempt was invoke Destroy multiple times. No Action\", {\n                    appInstanceId: params.context.instanceId,\n                });\n                return;\n            }\n            if (!this.isCreated) {\n                this.logger.error(\"An attempt was invoke Destroy before Create. No Action\", {\n                    appInstanceId: params.context.instanceId,\n                });\n                return;\n            }\n            this.isDestroyed = true;\n            this.state.isRunning = false;\n            this.logger.info(\"Begin Lifecycle Destroy\");\n            const { config } = this.provider;\n            const { success } = yield this.handleLifecycleChange(Object.assign(Object.assign({}, params), { stage: \"destroy\" }), (e) => (config.onDestroy ? config.onDestroy(e) : Promise.resolve()), true);\n            if (success) {\n                this.sendLifecycleHandlerCompletedMessage(params.context.instanceId, \"destroy\");\n            }\n        });\n    }\n    getAppLifecycleChangeParams() {\n        return {\n            context: new AppContext({\n                provider: this.provider,\n                instanceId: this.state.instanceId,\n                config: this.state.config,\n                contactScope: this.state.contactScope,\n                scope: this.state.scope,\n                parameters: this.state.parameters,\n                launchedBy: this.state.launchedBy,\n            }),\n        };\n    }\n}\n//# sourceMappingURL=app-lifecycle-manager.js.map","export const defaultValue = 5 * 1000;\nexport const minValue = 1;\nexport const maxValue = 60 * 1000;\nexport function getConnectionTimeout(config) {\n    var _a, _b;\n    return Math.max(1, Math.min(60000, (_b = (_a = config.workspace) === null || _a === void 0 ? void 0 : _a.connectionTimeout) !== null && _b !== void 0 ? _b : 5000));\n}\n//# sourceMappingURL=connection-timeout.js.map","import { ConnectLogger, Proxy, sdkVersion, TimeoutTracker, } from \"@amazon-connect/core\";\nimport { getConnectionTimeout } from \"./connection-timeout\";\nexport class AppProxy extends Proxy {\n    constructor(provider, lifecycleManager) {\n        super(provider);\n        this.channel = new MessageChannel();\n        this.lifecycleManager = lifecycleManager;\n        this.appLogger = new ConnectLogger({\n            source: \"app.appProxy\",\n            provider: provider,\n        });\n    }\n    get proxyType() {\n        return \"AppProxy\";\n    }\n    sendLifecycleHandlerCompleted(appInstanceId, stage) {\n        const msg = {\n            type: \"appLifecycleHandlerCompleted\",\n            stage,\n            appInstanceId,\n        };\n        this.sendOrQueueMessageToSubject(msg);\n    }\n    tryCloseApp(message, isFatalError, data) {\n        const msg = {\n            type: \"closeApp\",\n            isFatalError: isFatalError !== null && isFatalError !== void 0 ? isFatalError : false,\n            message,\n            data,\n        };\n        this.sendOrQueueMessageToSubject(msg);\n    }\n    sendServiceError(message, data) {\n        const msg = {\n            type: \"serviceError\",\n            message,\n            data,\n        };\n        this.sendOrQueueMessageToSubject(msg);\n    }\n    publish(topic, data) {\n        const msg = {\n            type: \"appPublish\",\n            topic,\n            data,\n        };\n        this.sendOrQueueMessageToSubject(msg);\n    }\n    initProxy() {\n        const hostInitMessage = {\n            type: \"connect-app-host-init\",\n            sdkVersion,\n            providerId: this.provider.id,\n        };\n        this.status.update({ status: \"initializing\" });\n        this.channel.port1.onmessage = (evt) => this.consumerMessageHandler(evt);\n        this.connectionTimer = TimeoutTracker.start(this.connectionTimeout.bind(this), getConnectionTimeout(this.provider.config));\n        window.parent.postMessage(hostInitMessage, \"*\", [this.channel.port2]);\n        this.appLogger.debug(\"Send connect message to configure proxy\");\n    }\n    sendMessageToSubject(message) {\n        this.channel.port1.postMessage(message);\n    }\n    getUpstreamMessageOrigin() {\n        if (document === null || document === void 0 ? void 0 : document.location) {\n            const { origin, pathname: path } = document.location;\n            return {\n                _type: \"app\",\n                providerId: this.provider.id,\n                origin,\n                path,\n            };\n        }\n        else {\n            return {\n                _type: \"app\",\n                providerId: this.provider.id,\n                origin: \"unknown\",\n                path: \"unknown\",\n            };\n        }\n    }\n    handleConnectionAcknowledge(msg) {\n        // ConnectionTimer will always be defined here\n        if (!this.connectionTimer.complete()) {\n            this.appLogger.error(\"Workspace connection acknowledge received after timeout. App is not connected to workspace.\", {\n                timeout: this.connectionTimer.timeoutMs,\n            });\n            return;\n        }\n        super.handleConnectionAcknowledge(msg);\n    }\n    handleMessageFromSubject(msg) {\n        switch (msg.type) {\n            case \"appLifecycle\":\n                this.lifecycleManager\n                    .handleLifecycleChangeMessage(msg)\n                    .catch((error) => {\n                    this.appLogger.error(\"An error occurred when invoking handleLifecycleChangeMessage\", { error });\n                });\n                break;\n            default:\n                super.handleMessageFromSubject(msg);\n        }\n    }\n    connectionTimeout(evt) {\n        this.status.update({\n            status: \"error\",\n            reason: \"Workspace connection timeout\",\n            details: Object.assign({}, evt),\n        });\n        this.publishError({\n            message: \"App failed to connect to workspace in the allotted time\",\n            key: \"workspaceConnectTimeout\",\n            details: Object.assign({}, evt),\n            isFatal: true,\n            proxyStatus: { initialized: false },\n        });\n    }\n    addContextToLogger() {\n        const { isRunning: appIsRunning } = this.lifecycleManager.appState;\n        if (document === null || document === void 0 ? void 0 : document.location) {\n            const { origin, pathname: path } = document.location;\n            return { appIsRunning, app: { origin, path } };\n        }\n        else {\n            return {\n                appIsRunning,\n                app: { origin: \"unknown\", path: \"unknown\" },\n            };\n        }\n    }\n}\n//# sourceMappingURL=app-proxy.js.map","import { AmazonConnectProviderBase, ConnectLogger, deepClone, getGlobalProvider, } from \"@amazon-connect/core\";\nimport { AppLifecycleManager } from \"./lifecycle/app-lifecycle-manager\";\nimport { AppProxy } from \"./proxy\";\nexport class AmazonConnectApp extends AmazonConnectProviderBase {\n    constructor(config) {\n        super({ config, proxyFactory: () => this.createProxy() });\n        this.lifecycleManager = new AppLifecycleManager(this);\n        this.logger = new ConnectLogger({ provider: this, source: \"app.provider\" });\n    }\n    static init(config) {\n        const provider = new AmazonConnectApp(config);\n        AmazonConnectApp.initializeProvider(provider);\n        return { provider };\n    }\n    static get default() {\n        return getGlobalProvider(\"AmazonConnectApp has not been initialized\");\n    }\n    createProxy() {\n        return new AppProxy(this, this.lifecycleManager);\n    }\n    onStart(handler, options) {\n        this.lifecycleManager.onStart(handler, options);\n    }\n    onStop(handler) {\n        this.lifecycleManager.onStop(handler);\n    }\n    offStart(handler) {\n        this.lifecycleManager.offStart(handler);\n    }\n    offStop(handler) {\n        this.lifecycleManager.offStop(handler);\n    }\n    sendCloseAppRequest(message) {\n        this.getProxy().tryCloseApp(message, false);\n    }\n    sendError(message, data) {\n        this.logger.error(message, data);\n    }\n    sendFatalError(message, data) {\n        this.getProxy().tryCloseApp(message, true, data ? deepClone(data) : undefined);\n    }\n    subscribe(topic, handler) {\n        this.getProxy().subscribe(topic, handler);\n    }\n    unsubscribe(topic, handler) {\n        this.getProxy().unsubscribe(topic, handler);\n    }\n    publish(topic, data) {\n        this.getProxy().publish(topic, deepClone(data));\n    }\n}\n//# sourceMappingURL=amazon-connect-app.js.map","export var AppContactScope;\n(function (AppContactScope) {\n    AppContactScope[\"CurrentContactId\"] = \"CURRENT_CONTACT\";\n})(AppContactScope || (AppContactScope = {}));\n//# sourceMappingURL=contact-scope.js.map","import { ServiceContext } from \"../service\";\nimport { LifecycleManager } from \"./lifecycle-manager\";\nexport class ServiceLifecycleManager extends LifecycleManager {\n    constructor(provider) {\n        super(provider);\n    }\n    handleLifecycleChangeMessage(msg) {\n        const context = new ServiceContext({\n            provider: this.provider,\n            instanceId: msg.instanceId,\n            config: msg.config,\n        });\n        this.state.appInstanceId = msg.appInstanceId;\n        this.state.instanceId = msg.instanceId;\n        this.state.appConfig = msg.appConfig;\n        this.state.config = msg.config;\n        const params = { context };\n        switch (msg.stage) {\n            case \"create\":\n                return this.handleCreate(params);\n            default:\n                this.logger.error(\"Attempted to send invalid stage to service\", {\n                    stage: msg.stage,\n                });\n                return Promise.reject(new Error(\"Invalid stage sent to service. Are you using AmazonConnectService for a 3P app? Use AmazonConnectApp\"));\n        }\n    }\n}\n//# sourceMappingURL=service-lifecycle-manager.js.map","import { AmazonConnectProviderBase, ConnectLogger, deepClone, getGlobalProvider, } from \"@amazon-connect/core\";\nimport { ServiceLifecycleManager } from \"../lifecycle/service-lifecycle-manager\";\nimport { AppProxy } from \"../proxy\";\nexport class AmazonConnectService extends AmazonConnectProviderBase {\n    constructor(config) {\n        super({ config, proxyFactory: () => this.createProxy() });\n        this.lifecycleManager = new ServiceLifecycleManager(this);\n        this.logger = new ConnectLogger({ provider: this, source: \"app.provider\" });\n    }\n    static init(config) {\n        const provider = new AmazonConnectService(config);\n        AmazonConnectService.initializeProvider(provider);\n        return { provider };\n    }\n    static get default() {\n        return getGlobalProvider(\"AmazonConnectService has not been initialized\");\n    }\n    createProxy() {\n        return new AppProxy(this, this.lifecycleManager);\n    }\n    sendError(message, data) {\n        this.logger.error(message, data);\n    }\n    sendFatalError(message, data) {\n        this.getProxy().sendServiceError(message, data ? deepClone(data) : undefined);\n    }\n    subscribe(topic, handler) {\n        this.getProxy().subscribe(topic, handler);\n    }\n    unsubscribe(topic, handler) {\n        this.getProxy().unsubscribe(topic, handler);\n    }\n    publish(topic, data) {\n        this.getProxy().publish(topic, deepClone(data));\n    }\n}\n//# sourceMappingURL=amazon-connect-service.js.map","import { Context } from \"@amazon-connect/core\";\nexport class ServiceContext extends Context {\n    constructor({ provider, instanceId, config, }) {\n        super(provider);\n        this.instanceId = instanceId;\n        this.config = config;\n    }\n}\n//# sourceMappingURL=service-context.js.map"],"names":["_provider","setGlobalProvider","provider","getGlobalProvider","notSetMessage","ConnectError","reason","namespace","errorKey","details","deepClone","object","cloneError","EmitterBase","loggerKey","ConnectLogger","parameter","handler","set","_a","__awaiter","thisArg","_arguments","P","generator","adopt","value","resolve","reject","fulfilled","step","e","rejected","result","AsyncEventEmitter","event","handlers","error","generateStringId","length","a","d","generateUUID","c","createModuleProxy","proxy","command","data","topic","h","SubscriptionHandlerIdMap","existingId","handlerId","id","SubscriptionMap","key","param","_b","_c","_d","_e","addFactory","updateAction","noParam","withParam","SubscriptionManager","acc","DurationMetricRecorder","sendMetric","metricName","metricOptions","durationResult","MAX_METRIC_DIMENSIONS","checkDimensionLength","dimensions","optionalDimensions","createMetricMessage","metricData","time","messageOrigin","ConnectMetricRecorder","params","processedDimensions","processedMetricOptions","count","unit","clientTimeoutResponseErrorKey","formatClientTimeoutError","request","timeoutMs","requestData","DEFAULT_TIMEOUT_MS","createRequestHandler","onStart","onTimeout","adjustedTimeoutMs","isTimedOut","timeout","msg","RequestManager","requestId","response","createRequestMessage","__rest","s","p","i","sanitizeDownstreamMessage","message","other","ChannelManager","relayChildUpstreamMessage","connectionId","existingChannel","originalChannel","setupParams","port","providerId","sendDownstreamMessage","setUpstreamMessageHandler","targetProviderId","channelData","ErrorService","isFatal","connectionStatus","handlerError","HealthCheckManager","sendHealthCheck","getUpstreamMessageOrigin","interval","previousStatus","status","ProxyConnectionStatusManager","evt","Proxy","origin","resp","logData","logMsg","createLogMessage","metricMessage","handlerIdMapping","_","fullError","subscriptionHandlerCount","subscriptionHandlerIds","TimeoutTracker","onCancelled","ms","LogLevel","logToConsole","level","LogDataTransformer","mixin","options","transformedData","sanitizeData","source","loggerId","context","sanitizedData","AmazonConnectProviderBase","config","proxyFactory","existingProvider","ModuleContext","engineContext","moduleNamespace","Context","sdkVersion","AppContext","instanceId","parameters","contactScope","scope","launchedBy","LifecycleManager","success","action","appInstanceId","stage","AppLifecycleManager","handlerRunResult","getConnectionTimeout","AppProxy","lifecycleManager","isFatalError","hostInitMessage","path","appIsRunning","AmazonConnectApp","AppContactScope","ServiceLifecycleManager","ServiceContext","AmazonConnectService"],"mappings":"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","x_google_ignoreList":[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43]}