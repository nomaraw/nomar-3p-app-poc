
<script src="https://nomaraw.github.io/nomar-3p-app-poc/dist/amazon-connect-app.umd.js"></script>

<script>
  (async () => {
    try {
      // Initialize AppMessageBridge
      const app = await window.AmazonConnectApp.App.init();

      console.log("APP INIT OK", app);

      // Lifecycle confirms the bridge
      app.on("create", () => console.log("[Workspace] lifecycle: create"));
      app.on("destroy", () => console.log("[Workspace] lifecycle: destroy"));

      // Cost-free agent interactions (idle state)
      const agentInfo = await app.agent.get();
      console.log("[Agent] snapshot:", agentInfo);

      app.agent.on("stateChange", (state) => {
        console.log("[Agent] stateChange:", state);
      });

      // Optional: contact updates (fire only in Test Chat)
      app.contact.on("update", (contact) => {
        console.log("[Contact] update:", contact);
      });

      // Custom event
      app.events.emit("nomar.poc.ping", { ts: Date.now() });
    } catch (err) {
      console.error("APP INIT FAILED", err);
    }
  })();
</script>
