
<!DOCTYPE html>
<html>
  <body style="font-family: sans-serif; padding: 20px;">
    <h2>Nomar 3P App ‚Äì Heartbeat Test</h2>
    <div id="status">Loading SDK‚Ä¶</div>

    <!-- 1) Load the official SDK directly from AWS CDN (NO BUILDING REQUIRED) -->
    <script src="https://unpkg.com/@amazon-connect/app/dist/app.min.js"></script>

    <!-- 2) AppMessageBridge initialization -->
    <script>
      (async () => {
        const status = (msg) => (document.getElementById("status").innerText = msg);

        // IMPORTANT: This only succeeds INSIDE Amazon Connect Agent Workspace iframe
        if (window.top === window) {
          status("‚ùå Not running inside Agent Workspace iframe. Open me from the Apps launcher.");
          return;
        }

        try {
          // AmazonConnectApp global is provided by the CDN script above
          const { AmazonConnectApp } = window;

          if (!AmazonConnectApp || typeof AmazonConnectApp.init !== "function") {
            status("‚ùå SDK failed to load.");
            return;
          }

          // Initialize per AWS lifecycle docs
          const { provider } = AmazonConnectApp.init({
            onCreate: () => {
              console.log("üíö Workspace connection established.");
              status("üíö CONNECTED to Agent Workspace (heartbeat OK)");
            },
            onDestroy: () => {
              console.log("üî¥ Workspace destroying app.");
            }
          });

          // OPTIONAL heartbeat message
          setInterval(() => {
            console.log("heartbeat ‚Üí workspace");
          }, 5000);

        } catch (err) {
          console.error("INIT FAILED", err);
          status("‚ùå Init failed (see console).");
        }
      })();
    </script>
  </body>
</html>
